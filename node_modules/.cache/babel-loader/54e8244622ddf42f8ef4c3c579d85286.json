{"ast":null,"code":"import _objectSpread from\"/Users/nalinr/MidlandAdmin/schooladmin/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import{useNavigate,useParams}from'react-router-dom';import{getApiUrl,getAuthHeaders}from'../../config';import{useAuth}from'../../context/AuthContext';import{useToast}from'../../context/ToastContext';import{FiArrowLeft}from'react-icons/fi';import{SkeletonForm}from'../../components/SkeletonLoader';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function StudentEdit(){const navigate=useNavigate();const{id}=useParams();const{token}=useAuth();const toast=useToast();const[form,setForm]=useState({});const[loading,setLoading]=useState(true);const[submitting,setSubmitting]=useState(false);const[error,setError]=useState('');useEffect(()=>{let isMounted=true;async function fetchStudent(){setLoading(true);setError('');try{const url=getApiUrl('/midland/admin/students/all');const res=await fetch(url,{headers:getAuthHeaders(token)});if(!res.ok){throw new Error('Failed to load student');}const data=await res.json();const list=Array.isArray(data)?data:[];const match=list.find(s=>String(s.schoolEmail)===id||String(s.personalEmail)===id||String(s.admissionNumber)===id||String(s.rollNo)===id);if(isMounted){if(match){setForm(match);}else{setError('Student not found');toast.error('Student not found');}}}catch(err){const errorMsg=err.message||'Failed to load student';if(isMounted)setError(errorMsg);toast.error(errorMsg);}finally{if(isMounted)setLoading(false);}}fetchStudent();return()=>{isMounted=false;};},[id,token,toast]);if(loading)return/*#__PURE__*/_jsx(\"div\",{className:\"page\",children:/*#__PURE__*/_jsx(SkeletonForm,{})});if(error&&!form.schoolEmail)return/*#__PURE__*/_jsx(\"div\",{className:\"page\",children:/*#__PURE__*/_jsx(\"div\",{className:\"alert alert-error\",children:error})});const emailKey=form.schoolEmail||form.personalEmail||id;return/*#__PURE__*/_jsxs(\"div\",{className:\"page\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"page-header\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Edit Student\"}),/*#__PURE__*/_jsxs(\"button\",{className:\"btn-secondary\",onClick:()=>navigate('/students'),children:[/*#__PURE__*/_jsx(FiArrowLeft,{size:16,style:{marginRight:8}}),\"Back to List\"]})]}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"alert alert-error\",children:error}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:async e=>{e.preventDefault();setError('');setSubmitting(true);try{const payload=_objectSpread({},form);const url=getApiUrl(\"/midland/admin/students/update/\".concat(encodeURIComponent(emailKey)));const res=await fetch(url,{method:'PUT',headers:getAuthHeaders(token),body:JSON.stringify(payload)});if(!res.ok){const errorText=await res.text().catch(()=>'');throw new Error(errorText||\"Failed to update: \".concat(res.status));}toast.success('Student updated successfully');navigate('/students',{replace:true});}catch(err){const errorMsg=err.message||'Failed to update student';setError(errorMsg);toast.error(errorMsg);}finally{setSubmitting(false);}},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-section\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Account\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-grid\",children:[/*#__PURE__*/_jsxs(\"label\",{children:[\"Username *\",/*#__PURE__*/_jsx(\"input\",{value:form.username||'',onChange:e=>setForm(_objectSpread(_objectSpread({},form),{},{username:e.target.value})),required:true})]}),/*#__PURE__*/_jsxs(\"label\",{children:[\"Password\",/*#__PURE__*/_jsx(\"input\",{type:\"password\",value:form.password||'',onChange:e=>setForm(_objectSpread(_objectSpread({},form),{},{password:e.target.value})),placeholder:\"Leave blank to keep current password\"})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-section\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Personal Info\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-grid\",children:[/*#__PURE__*/_jsxs(\"label\",{children:[\"Full Name *\",/*#__PURE__*/_jsx(\"input\",{value:form.fullName||'',onChange:e=>setForm(_objectSpread(_objectSpread({},form),{},{fullName:e.target.value})),required:true})]}),/*#__PURE__*/_jsxs(\"label\",{children:[\"Gender *\",/*#__PURE__*/_jsxs(\"select\",{value:form.gender||'',onChange:e=>setForm(_objectSpread(_objectSpread({},form),{},{gender:e.target.value})),required:true,children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Select\"}),/*#__PURE__*/_jsx(\"option\",{value:\"Male\",children:\"Male\"}),/*#__PURE__*/_jsx(\"option\",{value:\"Female\",children:\"Female\"}),/*#__PURE__*/_jsx(\"option\",{value:\"Other\",children:\"Other\"})]})]}),/*#__PURE__*/_jsxs(\"label\",{children:[\"Date of Birth *\",/*#__PURE__*/_jsx(\"input\",{type:\"date\",value:form.dateOfBirth||'',onChange:e=>setForm(_objectSpread(_objectSpread({},form),{},{dateOfBirth:e.target.value})),required:true})]}),/*#__PURE__*/_jsxs(\"label\",{children:[\"Blood Group\",/*#__PURE__*/_jsx(\"input\",{value:form.bloodGroup||'',onChange:e=>setForm(_objectSpread(_objectSpread({},form),{},{bloodGroup:e.target.value}))})]}),/*#__PURE__*/_jsxs(\"label\",{children:[\"Nationality\",/*#__PURE__*/_jsx(\"input\",{value:form.nationality||'',onChange:e=>setForm(_objectSpread(_objectSpread({},form),{},{nationality:e.target.value}))})]}),/*#__PURE__*/_jsxs(\"label\",{children:[\"Mother Tongue\",/*#__PURE__*/_jsx(\"input\",{value:form.motherTongue||'',onChange:e=>setForm(_objectSpread(_objectSpread({},form),{},{motherTongue:e.target.value}))})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-section\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Academic Info\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-grid\",children:[/*#__PURE__*/_jsxs(\"label\",{children:[\"School Code *\",/*#__PURE__*/_jsx(\"input\",{value:form.schoolCode||'',onChange:e=>setForm(_objectSpread(_objectSpread({},form),{},{schoolCode:e.target.value})),required:true})]}),/*#__PURE__*/_jsxs(\"label\",{children:[\"Class *\",/*#__PURE__*/_jsx(\"input\",{value:form.gradeLevel||'',onChange:e=>setForm(_objectSpread(_objectSpread({},form),{},{gradeLevel:e.target.value})),required:true})]}),/*#__PURE__*/_jsxs(\"label\",{children:[\"Section *\",/*#__PURE__*/_jsx(\"input\",{value:form.section||'',onChange:e=>setForm(_objectSpread(_objectSpread({},form),{},{section:e.target.value})),required:true})]}),/*#__PURE__*/_jsxs(\"label\",{children:[\"Academic Year *\",/*#__PURE__*/_jsx(\"input\",{value:form.academicYear||'',onChange:e=>setForm(_objectSpread(_objectSpread({},form),{},{academicYear:e.target.value})),required:true})]}),/*#__PURE__*/_jsxs(\"label\",{children:[\"Admission Date *\",/*#__PURE__*/_jsx(\"input\",{type:\"date\",value:form.admissionDate||'',onChange:e=>setForm(_objectSpread(_objectSpread({},form),{},{admissionDate:e.target.value})),required:true})]}),/*#__PURE__*/_jsxs(\"label\",{children:[\"Status\",/*#__PURE__*/_jsxs(\"select\",{value:form.status||'Active',onChange:e=>setForm(_objectSpread(_objectSpread({},form),{},{status:e.target.value})),children:[/*#__PURE__*/_jsx(\"option\",{value:\"Active\",children:\"Active\"}),/*#__PURE__*/_jsx(\"option\",{value:\"Inactive\",children:\"Inactive\"})]})]}),/*#__PURE__*/_jsxs(\"label\",{children:[\"Admission No *\",/*#__PURE__*/_jsx(\"input\",{value:form.admissionNumber||'',onChange:e=>setForm(_objectSpread(_objectSpread({},form),{},{admissionNumber:e.target.value})),required:true})]}),/*#__PURE__*/_jsxs(\"label\",{children:[\"Roll No *\",/*#__PURE__*/_jsx(\"input\",{value:form.rollNo||'',onChange:e=>setForm(_objectSpread(_objectSpread({},form),{},{rollNo:e.target.value})),required:true})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-section\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Contact Details\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-grid\",children:[/*#__PURE__*/_jsxs(\"label\",{children:[\"Phone Number\",/*#__PURE__*/_jsx(\"input\",{value:form.phoneNumber||'',onChange:e=>setForm(_objectSpread(_objectSpread({},form),{},{phoneNumber:e.target.value}))})]}),/*#__PURE__*/_jsxs(\"label\",{children:[\"School Email *\",/*#__PURE__*/_jsx(\"input\",{type:\"email\",value:form.schoolEmail||'',onChange:e=>setForm(_objectSpread(_objectSpread({},form),{},{schoolEmail:e.target.value})),required:true})]}),/*#__PURE__*/_jsxs(\"label\",{children:[\"Personal Email\",/*#__PURE__*/_jsx(\"input\",{type:\"email\",value:form.personalEmail||'',onChange:e=>setForm(_objectSpread(_objectSpread({},form),{},{personalEmail:e.target.value}))})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-section\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Guardian Info\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-grid\",children:[/*#__PURE__*/_jsxs(\"label\",{children:[\"Guardian Name\",/*#__PURE__*/_jsx(\"input\",{value:form.guardianName||'',onChange:e=>setForm(_objectSpread(_objectSpread({},form),{},{guardianName:e.target.value}))})]}),/*#__PURE__*/_jsxs(\"label\",{children:[\"Guardian Relation\",/*#__PURE__*/_jsx(\"input\",{value:form.guardianRelation||'',onChange:e=>setForm(_objectSpread(_objectSpread({},form),{},{guardianRelation:e.target.value}))})]}),/*#__PURE__*/_jsxs(\"label\",{children:[\"Guardian Contact\",/*#__PURE__*/_jsx(\"input\",{value:form.guardianContact||'',onChange:e=>setForm(_objectSpread(_objectSpread({},form),{},{guardianContact:e.target.value}))})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-actions\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn-secondary\",onClick:()=>navigate('/students'),children:\"Cancel\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"btn-primary\",disabled:submitting,children:submitting?'Updating...':'Update Student'})]})]})]});}","map":null,"metadata":{},"sourceType":"module"}