{"ast":null,"code":"import React,{useCallback,useEffect,useMemo,useState}from'react';import Modal from'react-modal';import{useNavigate}from'react-router-dom';import{getApiUrl,getAuthHeaders}from'../../config';import{useAuth}from'../../context/AuthContext';import{useToast}from'../../context/ToastContext';import{FiEdit2,FiTrash2,FiPlus,FiSearch,FiBriefcase}from'react-icons/fi';import{SkeletonTable}from'../../components/SkeletonLoader';import EmptyState from'../../components/EmptyState';import StatusBadge from'../../components/StatusBadge';import Pagination from'../../components/Pagination';import SortableTableHeader from'../../components/SortableTableHeader';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function Admins(){const navigate=useNavigate();const{token}=useAuth();const toast=useToast();const[query,setQuery]=useState('');const[designation,setDesignation]=useState('');const[admins,setAdmins]=useState([]);const[loading,setLoading]=useState(false);const[error,setError]=useState('');const[deleteOpen,setDeleteOpen]=useState(false);const[deleteEmail,setDeleteEmail]=useState('');const[deleting,setDeleting]=useState(false);const[deleteError,setDeleteError]=useState('');const[currentPage,setCurrentPage]=useState(1);const itemsPerPage=6;const[sortConfig,setSortConfig]=useState({key:null,direction:'asc'});const fetchAdmins=useCallback(async()=>{setLoading(true);setError('');try{const url=getApiUrl('/midland/admin/all');const res=await fetch(url,{headers:getAuthHeaders(token)});if(!res.ok){throw new Error(\"Failed to load admins: \".concat(res.status,\" \").concat(res.statusText));}const data=await res.json();setAdmins(Array.isArray(data)?data:[]);}catch(err){const errorMsg=err.message||'Failed to load admins';setError(errorMsg);toast.error(errorMsg);}finally{setLoading(false);}},[token,toast]);useEffect(()=>{fetchAdmins();},[fetchAdmins]);useEffect(()=>{try{Modal.setAppElement('#root');}catch(_){}},[]);const designations=useMemo(()=>{return Array.from(new Set(admins.map(a=>String(a.designation||'').trim()).filter(Boolean)));},[admins]);const handleSort=(key,direction)=>{setSortConfig({key,direction});setCurrentPage(1);};const sortedAndFilteredRows=useMemo(()=>{const q=query.trim().toLowerCase();let filtered=admins.filter(a=>{const name=String(a.fullName||'').toLowerCase();const email=String(a.schoolEmail||a.personalEmail||'').toLowerCase();const queryMatch=!q||name.includes(q)||email.includes(q);const desigMatch=!designation||String(a.designation||'')===designation;return queryMatch&&desigMatch;}).map(a=>({key:a.schoolEmail||a.personalEmail||Math.random(),id:a.adminCode||a.schoolEmail||'-',name:a.fullName||'-',email:a.schoolEmail||a.personalEmail||'-',designation:a.designation||'-',schoolCode:a.schoolCode||'-',status:a.status||'Active',emailKey:a.schoolEmail||a.personalEmail||''}));if(sortConfig.key){filtered.sort((a,b)=>{let aVal=a[sortConfig.key];let bVal=b[sortConfig.key];if(typeof aVal==='string'){aVal=aVal.toLowerCase();bVal=bVal.toLowerCase();}if(aVal<bVal)return sortConfig.direction==='asc'?-1:1;if(aVal>bVal)return sortConfig.direction==='asc'?1:-1;return 0;});}return filtered;},[admins,query,designation,sortConfig]);const totalPages=Math.ceil(sortedAndFilteredRows.length/itemsPerPage);const startIndex=(currentPage-1)*itemsPerPage;const endIndex=startIndex+itemsPerPage;const rows=sortedAndFilteredRows.slice(startIndex,endIndex);useEffect(()=>{if(currentPage>totalPages&&totalPages>0){setCurrentPage(1);}},[totalPages,currentPage]);return/*#__PURE__*/_jsxs(\"div\",{className:\"page admins\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"page-header\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"header-main\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Administrators\"}),/*#__PURE__*/_jsx(\"div\",{className:\"meta\",children:loading?'Loading…':\"\".concat(sortedAndFilteredRows.length,\" admin\").concat(sortedAndFilteredRows.length!==1?'s':'')})]}),/*#__PURE__*/_jsxs(\"button\",{className:\"btn-primary\",onClick:()=>navigate('/admin/create'),children:[/*#__PURE__*/_jsx(FiPlus,{size:18,style:{marginRight:8}}),\"Add Admin\"]})]}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"alert alert-error\",children:error}),/*#__PURE__*/_jsxs(\"div\",{className:\"filters\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"filter-input-wrapper\",children:[/*#__PURE__*/_jsx(FiSearch,{className:\"filter-icon\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Search by name or email...\",value:query,onChange:e=>setQuery(e.target.value),className:\"filter-input\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"filter-select-wrapper\",children:[/*#__PURE__*/_jsx(FiBriefcase,{className:\"filter-icon\"}),/*#__PURE__*/_jsxs(\"select\",{value:designation,onChange:e=>setDesignation(e.target.value),className:\"filter-select\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"All Designations\"}),designations.map(d=>/*#__PURE__*/_jsx(\"option\",{value:d,children:d},d))]})]})]}),loading?/*#__PURE__*/_jsx(SkeletonTable,{rows:5,columns:4}):sortedAndFilteredRows.length===0?/*#__PURE__*/_jsx(EmptyState,{type:\"admins\",actionLabel:\"Add Admin\",onAction:()=>navigate('/admin/create')}):/*#__PURE__*/_jsx(\"div\",{className:\"table-container\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"data-table\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(SortableTableHeader,{sortKey:\"id\",currentSort:sortConfig,onSort:handleSort,children:\"ID\"}),/*#__PURE__*/_jsx(SortableTableHeader,{sortKey:\"name\",currentSort:sortConfig,onSort:handleSort,children:\"Name\"}),/*#__PURE__*/_jsx(SortableTableHeader,{sortKey:\"email\",currentSort:sortConfig,onSort:handleSort,children:\"Email\"}),/*#__PURE__*/_jsx(SortableTableHeader,{sortKey:\"designation\",currentSort:sortConfig,onSort:handleSort,children:\"Designation\"}),/*#__PURE__*/_jsx(SortableTableHeader,{sortKey:\"schoolCode\",currentSort:sortConfig,onSort:handleSort,children:\"School Code\"}),/*#__PURE__*/_jsx(SortableTableHeader,{sortKey:\"status\",currentSort:sortConfig,onSort:handleSort,children:\"Status\"}),/*#__PURE__*/_jsx(SortableTableHeader,{className:\"actions-column\",children:\"Actions\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:rows.map(row=>/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{className:\"cell-id\",children:row.id}),/*#__PURE__*/_jsx(\"td\",{className:\"cell-name\",children:/*#__PURE__*/_jsx(\"button\",{className:\"name-link\",onClick:()=>navigate(\"/admin/\".concat(encodeURIComponent(row.emailKey||row.id))),title:\"View Profile\",children:row.name})}),/*#__PURE__*/_jsx(\"td\",{className:\"cell-email\",children:row.email}),/*#__PURE__*/_jsx(\"td\",{className:\"cell-small\",children:row.designation}),/*#__PURE__*/_jsx(\"td\",{className:\"cell-small\",children:row.schoolCode}),/*#__PURE__*/_jsx(\"td\",{className:\"cell-status\",children:/*#__PURE__*/_jsx(StatusBadge,{status:row.status})}),/*#__PURE__*/_jsx(\"td\",{className:\"cell-actions\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"action-buttons\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn-icon\",onClick:()=>navigate(\"/admin/\".concat(encodeURIComponent(row.emailKey||row.id),\"/edit\")),title:\"Edit\",\"aria-label\":\"Edit admin\",children:/*#__PURE__*/_jsx(FiEdit2,{size:18})}),/*#__PURE__*/_jsx(\"button\",{className:\"btn-icon btn-danger\",onClick:()=>{setDeleteEmail(row.emailKey);setDeleteOpen(true);},title:\"Delete\",\"aria-label\":\"Delete admin\",children:/*#__PURE__*/_jsx(FiTrash2,{size:18})})]})})]},row.key))})]})}),!loading&&sortedAndFilteredRows.length>0&&/*#__PURE__*/_jsx(Pagination,{currentPage:currentPage,totalPages:totalPages,onPageChange:setCurrentPage}),/*#__PURE__*/_jsx(Modal,{isOpen:deleteOpen,onRequestClose:()=>!deleting&&setDeleteOpen(false),className:\"modal\",overlayClassName:\"modal-overlay\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"modal-content\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Delete Administrator\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Are you sure you want to delete this administrator? This action cannot be undone.\"}),deleteError&&/*#__PURE__*/_jsx(\"div\",{className:\"alert alert-error\",style:{marginBottom:16},children:deleteError}),/*#__PURE__*/_jsxs(\"div\",{className:\"modal-actions\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn-secondary\",onClick:()=>setDeleteOpen(false),disabled:deleting,children:\"Cancel\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn-danger\",disabled:deleting,onClick:async()=>{if(!deleteEmail)return;setDeleting(true);setDeleteError('');try{const emailKey=encodeURIComponent(deleteEmail);const url=getApiUrl(\"/midland/admin/delete/\".concat(emailKey));const res=await fetch(url,{method:'DELETE',headers:getAuthHeaders(token)});if(!res.ok){const errorText=await res.text().catch(()=>'');throw new Error(errorText||\"Failed to delete: \".concat(res.status));}setDeleteOpen(false);toast.success('Administrator deleted successfully');fetchAdmins();}catch(err){const errorMsg=err.message||'Failed to delete admin';setDeleteError(errorMsg);toast.error(errorMsg);}finally{setDeleting(false);}},children:deleting?'Deleting…':'Delete'})]})]})})]});}","map":null,"metadata":{},"sourceType":"module"}