{"ast":null,"code":"import React,{useEffect,useMemo,useState}from'react';import{getApiUrl,getAuthHeaders}from'../config';import{useAuth}from'../context/AuthContext';import{useToast}from'../context/ToastContext';import{SkeletonTable}from'../components/SkeletonLoader';import EmptyState from'../components/EmptyState';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function Subjects(){const{token}=useAuth();const toast=useToast();const[query,setQuery]=useState('');const[grade,setGrade]=useState('');const[curriculum,setCurriculum]=useState('');const[subjects,setSubjects]=useState([]);const[loading,setLoading]=useState(false);const[error,setError]=useState('');useEffect(()=>{let isMounted=true;async function fetchSubjects(){setLoading(true);setError('');try{const path='/midland/users/subjects/all';const url=getApiUrl(path);const res=await fetch(url,{headers:getAuthHeaders(token)});if(!res.ok){throw new Error(\"Request failed \".concat(res.status));}const data=await res.json();if(isMounted)setSubjects(Array.isArray(data)?data:[]);}catch(err){const errorMsg=err.message||'Failed to load subjects';if(isMounted)setError(errorMsg);toast.error(errorMsg);}finally{if(isMounted)setLoading(false);}}fetchSubjects();return()=>{isMounted=false;};},[token,toast]);const grades=useMemo(()=>Array.from(new Set(subjects.map(s=>String(s.gradeLevel||'').trim()).filter(Boolean))),[subjects]);const curricula=useMemo(()=>Array.from(new Set(subjects.map(s=>String(s.curriculumType||'').trim()).filter(Boolean))),[subjects]);const rows=useMemo(()=>{const q=query.trim().toLowerCase();return subjects.filter(s=>{const name=String(s.subjectName||'').toLowerCase();const code=String(s.subjectCode||'').toLowerCase();const gradeMatch=!grade||String(s.gradeLevel||'')===grade;const currMatch=!curriculum||String(s.curriculumType||'')===curriculum;const queryMatch=!q||name.includes(q)||code.includes(q);return gradeMatch&&currMatch&&queryMatch;}).map(s=>({key:s.subjectCode||s.subjectName,subjectName:s.subjectName||'-',subjectCode:s.subjectCode||'-',curriculumType:s.curriculumType||'-',gradeLevel:s.gradeLevel||'-',teacherCode:s.teacherCode||'-'}));},[subjects,query,grade,curriculum]);return/*#__PURE__*/_jsxs(\"div\",{className:\"page subjects\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"page-header\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"header-main\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Subjects\"}),/*#__PURE__*/_jsx(\"div\",{className:\"meta\",children:loading?'Loadingâ€¦':\"\".concat(rows.length,\" subject\").concat(rows.length!==1?'s':'')})]})}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"alert alert-error\",children:error}),/*#__PURE__*/_jsxs(\"div\",{className:\"filters\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Search by name or code...\",value:query,onChange:e=>setQuery(e.target.value),className:\"filter-input\"}),/*#__PURE__*/_jsxs(\"select\",{value:grade,onChange:e=>setGrade(e.target.value),className:\"filter-select\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"All Grades\"}),grades.map(g=>/*#__PURE__*/_jsx(\"option\",{value:g,children:g},g))]}),/*#__PURE__*/_jsxs(\"select\",{value:curriculum,onChange:e=>setCurriculum(e.target.value),className:\"filter-select\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"All Curricula\"}),curricula.map(c=>/*#__PURE__*/_jsx(\"option\",{value:c,children:c},c))]})]}),loading?/*#__PURE__*/_jsx(SkeletonTable,{rows:5,columns:5}):rows.length===0?/*#__PURE__*/_jsx(EmptyState,{type:\"subjects\"}):/*#__PURE__*/_jsx(\"div\",{className:\"table-container\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"data-table\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"Subject Name\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Subject Code\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Grade Level\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Curriculum\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Teacher Code\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:rows.map(row=>/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:row.subjectName}),/*#__PURE__*/_jsx(\"td\",{children:row.subjectCode}),/*#__PURE__*/_jsx(\"td\",{children:row.gradeLevel}),/*#__PURE__*/_jsx(\"td\",{children:row.curriculumType}),/*#__PURE__*/_jsx(\"td\",{children:row.teacherCode})]},row.key))})]})})]});}","map":null,"metadata":{},"sourceType":"module"}